{% extends 'base_main.html' %}

{% block title %}Post - {{ post.user_username|capitalize }}{% endblock %}

{% block main %}
{% if config.TESTING %}
<!-- view:post:{{post.pid}} -->
{% endif %}
<div id="post" class="block clearfix">
    <div class="top-section">
        <img class="avatar" src="{{ post.user_email|avatar(48) }}" />

        <div class="control">
            {% if post.user_username == current_user.username %}
            <a href="{{ url_for('delete_post', username=post.user_username, pid=post.pid) }}"><div class="delete">X</div></a>
            {% endif %}
        </div>

        <div class="details clearfix">
            <div class="username">
                <a href="{{ url_for('profile', username=post.user_username) }}">
                    {{ post.user_username|capitalize }}
                </a>
                <span class="user-score">{{ post.user_score|millify }}</span>
            </div>
            <div class="body">
                {% autoescape false %}
                {{ post.body|e|urlize|nameify }}
                {% endautoescape %}
            </div>
            <div class="created">{{ post.created|timeify }} GMT</div>
        </div>
    </div>
    <div class="panel clearfix">
        <ul class="voting clearfix">
            <li class="voting-item first">
                {{ post['score']|millify }}
            </li>
            {% if post.user_username != current_user.username %}
            {% if post.pid|voted %}
                <li class="voting-item">
                    {% if post.pid|voted > 0 %}
                    <img src="{{ url_for('static', filename='img/glyphicons/up_arrow.png') }}" width="16" height="16"/>
                    {% else %}
                    <img src="{{ url_for('static', filename='img/glyphicons/down_arrow.png') }}" width="16" height="16"/>
                    {% endif %}
                </li>
            {% else %}
            <a href="{{ url_for('upvote', username=post.user_username, pid=post.pid, next=request.url) }}">
                <li class="voting-item link">
                    <img src="{{ url_for('static', filename='img/glyphicons/up_arrow.png') }}" width="16" height="16"/>
                </li>
            </a>
            <a href="{{ url_for('downvote', username=post.user_username, pid=post.pid, next=request.url) }}">
                <li class="voting-item link">
                    <img src="{{ url_for('static', filename='img/glyphicons/down_arrow.png') }}" width="16" height="16"/>
                </li>
            </a>
            {% endif %}
            {% endif %}
        </ul>
    </div>
</div>

{% include 'author_comment.html' %}

<div id="content" class="block clearfix">
    <h1>Comments</h1>
    {% include 'list_comments.html' %}
</div>
{% endblock %}
