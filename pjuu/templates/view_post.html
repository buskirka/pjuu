{% extends 'base_main.html' %}

{% block title %}Post - {{ post.user_username|capitalize }}{% endblock %}

{% block main %}
{% if config.TESTING %}
<!-- view:post:{{post.pid}} -->
{% endif %}
<div id="post" class="block clearfix">
    <img class="avatar" src="{{ post.user_email|avatar(48) }}" />

    <div class="control">
        {% if post.uid == current_user.uid %}
        {% if config.TESTING %}
        <!-- delete_post:{{ post.pid }} -->
        {% endif %}
        <a href="{{ url_for('delete_post', username=post.user_username, pid=post.pid, next=request.path) }}" class="fa fa-remove fa-lg delete"></a>
        {% endif %}
    </div>

    <div class="content clearfix">
        <div class="username">
            <a href="{{ url_for('profile', username=post.user_username) }}">{{ post.user_username|capitalize }}</a>
            <span class="created">{{ post.created|timeify }}</span>
        </div>
        <div class="body">
            {% autoescape false %}
            {{ post.body|e|urlize|nameify }}
            {% endautoescape %}
        </div>
        <div class="panel clearfix">
            <ul>
                <li>
                    <i class="fa fa-trophy fa-lg"></i> {{ post['score']|millify }}
                </li>
                {% if post.uid != current_user.uid %}
                <li>
                    {% if post.pid|voted > 0 %}
                    {% if config.TESTING %}
                    <!-- action:upvoted -->
                    {% endif %}
                    <i class="fa fa-arrow-up fa-lg upvoted"></i>
                    {% elif post.pid|voted < 0 %}
                    <i class="fa fa-arrow-up fa-lg inactive"></i>
                    {% else %}
                    {% if config.TESTING %}
                    <!-- action:upvote -->
                    {% endif %}
                    <a href="{{ url_for('upvote', username=post.user_username, pid=post.pid, next=request.path) }}" class="fa fa-arrow-up fa-lg link upvote"></a>
                    {% endif %}
                </li>
                <li>
                    {% if post.pid|voted < 0 %}
                    {% if config.TESTING %}
                    <!-- action:downvoted -->
                    {% endif %}
                    <i class="fa fa-arrow-down fa-lg downvoted"></i>
                    {% elif post.pid|voted > 0 %}
                    <i class="fa fa-arrow-down fa-lg inactive"></i>
                    {% else %}
                    {% if config.TESTING %}
                    <!-- action:downvote -->
                    {% endif %}
                    <a href="{{ url_for('downvote', username=post.user_username, pid=post.pid, next=request.path) }}" class="fa fa-arrow-down fa-lg link downvote"></a>
                    {% endif %}
                </li>
                {% endif %}
            </ul>
            {% if post.pid|subscribed %}
            <div class="right">
                {% if config.TESTING %}
                <!-- unsubscribe:{{ post.pid }} -->
                {% endif %}
                <a href="{{ url_for('unsubscribe', username=post.user_username, pid=post.pid, next=request.path + '?' + request.query_string) }}" class="fa fa-bell-slash fa-lg link unsubscribe"></a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% include 'author_comment.html' %}

<div id="content" class="block clearfix">
    <h1>Comments</h1>
    {% include 'list_comments.html' %}
</div>
{% endblock %}
